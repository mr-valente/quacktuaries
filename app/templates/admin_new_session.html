{% extends "base.html" %}
{% block title %}New Session ‚Äî Quacktuaries{% endblock %}

{% block nav_links %}
  <a href="/admin/dashboard">Dashboard</a>
  <a href="/admin/logout">Logout</a>
  <span style="color:var(--text-muted);">|</span>
  <span style="color:var(--text-muted); font-size:0.85rem;">üë©‚Äçüè´ {{ teacher.name }}</span>
{% endblock %}

{% block content %}
<div style="max-width:600px; margin:0 auto;">
  <div class="card">
    <h2>Create New Session</h2>

    <form method="post" action="/admin/session/create">
      <div class="form-group">
        <label for="difficulty">Difficulty Preset</label>
        <select id="difficulty" name="difficulty" class="form-control">
          {% for key, preset in presets.items() %}
          <option value="{{ key }}" {% if key == 'medium' %}selected{% endif %}>
            {{ key | capitalize }} ‚Äî {{ preset.description }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="device_count">Duck Batches</label>
          <input type="number" id="device_count" name="device_count" class="form-control"
                 value="{{ defaults.device_count }}" min="2" max="50">
        </div>
        <div class="form-group">
          <label for="max_turns">Max Turns</label>
          <input type="number" id="max_turns" name="max_turns" class="form-control"
                 value="{{ defaults.max_turns }}" min="1" max="100">
        </div>
        <div class="form-group">
          <label for="test_budget">Test Budget</label>
          <input type="number" id="test_budget" name="test_budget" class="form-control"
                 value="{{ defaults.test_budget }}" min="10" max="10000">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="min_n">Min n per Test</label>
          <input type="number" id="min_n" name="min_n" class="form-control"
                 value="{{ defaults.min_n }}" min="1" max="100">
        </div>
        <div class="form-group">
          <label for="max_n">Max n per Test</label>
          <input type="number" id="max_n" name="max_n" class="form-control"
                 value="{{ defaults.max_n }}" min="1" max="1000">
        </div>
        <div class="form-group">
          <label for="premium_scale">Premium Scale</label>
          <input type="number" id="premium_scale" name="premium_scale" class="form-control"
                 value="{{ defaults.premium_scale }}" min="1" max="10000">
        </div>
      </div>

      <button type="submit" class="btn btn-primary" style="width:100%; margin-top:0.5rem;">Create Session</button>
    </form>
  </div>
</div>

<script>
var difficultyPresets = {
  {% for key, preset in presets.items() %}
  "{{ key }}": {
    "device_count": {{ preset.device_count }},
    "max_turns": {{ preset.max_turns }},
    "test_budget": {{ preset.test_budget }},
    "min_n": {{ preset.min_n }},
    "max_n": {{ preset.max_n }}
  }{% if not loop.last %},{% endif %}
  {% endfor %}
};
document.getElementById('difficulty').addEventListener('change', function() {
  var p = difficultyPresets[this.value];
  if (!p) return;
  document.getElementById('device_count').value = p.device_count;
  document.getElementById('max_turns').value = p.max_turns;
  document.getElementById('test_budget').value = p.test_budget;
  document.getElementById('min_n').value = p.min_n;
  document.getElementById('max_n').value = p.max_n;
});
</script>
{% endblock %}
